"use client";

import { useState } from "react";
import { SearchBar } from "./components/SearchBar";
import { Pagination } from "./components/Pagination";
import { SearchBarTest } from "./components/SearchBarTest";
import { useQuery, useQueryClient } from "@tanstack/react-query";
import { ResultsList } from "./components/ResultsList";
import axios from "axios";

const page = 1;
const itemsPerPage = 10;

export default function Page() {
  const [keyword, setKeyword] = useState("");
  const [cveList, setCveList] = useState([]);
  const [totalResults, setTotalResults] = useState(0);

  const useFetchCveData = (keyword, page, itemsPerPage) => {
    const apiUrl = "https://services.nvd.nist.gov/rest/json/cves/2.0";

    return useQuery({
      queryKey: ["vulnerabilities", keyword, page, itemsPerPage],
      queryFn: () => axios.get(`${apiUrl}?keywordSearch=${encodeURIComponent(keyword)}&resultsPerPage=${itemsPerPage}&startIndex=${(page - 1) * itemsPerPage}`),
      enabled: false,
    });
  };

  const { data, isLoading, isError, refetch } = useFetchCveData(keyword, page, itemsPerPage);

  const handleClick = () => {
    if (!data) {
      refetch();
    }
    console.log(data);
  };

  return (
    <div className="container mx-auto">
      <div className="flex flex-col items-center justify-center">
        <h1 className="text-2xl font-bold mb-4">NVD Vulnerability Search</h1>
        <SearchBar keyword={keyword} setKeyword={setKeyword} onClick={handleClick} />
        {isLoading ? <div>Loading ...</div> : isError ? <div>Error!</div> : <div></div>}
      </div>
    </div>
  );
}
